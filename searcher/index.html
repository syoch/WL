<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>WL Searcher</title>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.3.1/fuse.min.js"></script>

</head>

<body>
  <input type="text" id="target" onchange="search()">
  <input type="button" value="検索" onclick="search()">
  <table style="width: 90vw;" border="1">
    <thead>
      <th>WL番号</th>
      <th>起源</th>
      <th>内容</th>
    </thead>
    <tbody id="result">
    </tbody>
  </table>

  <script>
    // var fuse = new Fuse(list, options);

    class WL {
      constructor(arr) {
        this.wl_id = arr[0].toString();
        this.author = arr[1].toString();
        this.content = arr[2].toString();
      }

      match(target) {
        return this.wl_id.includes(target) |
          this.author.includes(target) |
          this.content.includes(target);
      }

      toElement() {
        let row = $("<tr>");
        row.append($("<td>").text(this.wl_id));
        row.append($("<td>").text(this.author));
        row.append($("<td>").text(this.content));
        return row;
      }
    }

    function search_WL(target) {
      let results = [];

      for (let wl of dict) {
        if (wl.match(target)) {
          results.push(wl);
        }
      }

      return results;
    }


    function search(target = "") {
      if (target == "") {
        target = $("#target").val();
      }
      let results = search_WL(target);

      let elem = $("#result");
      elem.empty();

      for (let key of results) {
        elem.append(key.toElement());
      }
    }


    $(() => {
      $.getJSON("database.json?" + Date().toString().replaceAll(/\D/g, ""), (data) => {
        window.dict = [];
        for (let val of data) {
          window.dict.push(new WL(val));
        }
      }).then(() => {
        search("エンジェルコア");
      });

    })
  </script>
</body>

</html>